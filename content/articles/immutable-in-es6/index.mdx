---
title: "JavaScript immutable"
date: "2021-01-01"
featured: false
category: "js"
excerpt: "ç¼–å†™ä¸å¯å˜çš„ Javascript ä»£ç æ˜¯ä¸€ç§å¥½çš„åšæ³•."
tag: ["js"]
status: "publish"
type: "post"
cover: "./cover.png"
---

ç¼–å†™ä¸å¯å˜çš„ Javascript ä»£ç æ˜¯ä¸€ç§å¥½çš„åšæ³•.

## ä¸å˜æ€§
é¦–å…ˆï¼Œä¸ºä»€ä¹ˆä¸å˜æ€§å¾ˆé‡è¦?
> æ›´æ”¹æ•°æ®ä¼šäº§ç”Ÿéš¾ä»¥è¯»å–ä¸”å®¹æ˜“å‡ºé”™çš„ä»£ç ã€‚

åƒReduxå’ŒNGRXç±»åº“, å…¶å—æ¬¢è¿ç¨‹åº¦æ¿€å¢ã€‚ä»–ä»¬å…±åŒçš„è¦æ±‚æ˜¯ä¸€ä¸ªä¸å¯å˜çš„çŠ¶æ€ã€‚  
åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ˜¯æŒ‰é¡ºåºåº”ç”¨äºåˆå§‹çŠ¶æ€çš„æ“ä½œåˆ—è¡¨çš„ç»“æœã€‚  
åº”ç”¨ç¨‹åºçš„æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ä¸å¯æ›´æ”¹çš„, æ–°æ“ä½œä½¿ç”¨ç°æœ‰çŠ¶æ€è®¡ç®—æ–°æ“ä½œã€‚  
è¿™æœ‰åŠ©äºæˆ‘ä»¬é€šè¿‡å¯å˜æ“ä½œé¿å…æ„å¤–çŠ¶æ€æ›´æ”¹.

### ä¸å¯å˜æ•°ç»„æ“ä½œ

**æ•°ç»„**æœ‰å‡ ä¸ªå¯å˜æ“ä½œ, è¿™é‡Œå›é¡¾å…¶ç”¨æ³•ä¸äº†è§£æ–°æ–¹æ³•
- push
- pop
- splice
- shift
- unshift
- reverse
- sort



##### Push

```js
const fruits = ['orange', 'apple', 'lemon'];
fruits.push('banana');                                  // = ['orange', 'apple', 'lemon', 'banana']
```
ä¸å¯å˜ ğŸ‘‡
```js
const fruits    = ['orange', 'apple', 'lemon'];
const newFruits = [...fruits, 'banana'];                // = ['orange', 'apple', 'lemon', 'banana']
```

##### Unshift

```js
const fruits = ['orange', 'apple', 'lemon'];
fruits.unshift('banana');                               // = ['banana', 'orange', 'apple', 'lemon']
```
ä¸å¯å˜ ğŸ‘‡
```js
const fruits    = ['orange', 'apple', 'lemon'];
const newFruits = ['banana', ...fruits];                // = ['banana', 'orange', 'apple', 'lemon']
```

##### Pop
```js
const fruits    = ['orange', 'apple', 'lemon', 'banana'];
const lastFruit = fruits.pop();                         // = 'banana', fruits = ['orange', 'apple', 'lemon']
```
ä¸å¯å˜ ğŸ‘‡
```js
const fruits    = ['orange', 'apple', 'lemon', 'banana'];
const lastFruit = fruits[fruits.length - 1];            // = 'banana'
const newFruits = fruits.slice(0, fruits.length - 1);   // = ['orange', 'apple', 'lemon']
```

##### Shift
```js
const fruits        = ['orange', 'apple', 'lemon', 'banana'];
const firstFruit    = fruits.shift();                   // = 'orange', fruits = ['apple', 'lemon', 'banana']
```
ä¸å¯å˜ ğŸ‘‡
```js
const fruits        = ['orange', 'apple', 'lemon', 'banana'];
const firstFruit    = fruits[0]; // = 'orange'
const newFruits     = fruits.slice(1); // = ['apple', 'lemon', 'banana']
```

##### åˆ é™¤é¡¹ç›®
é€šå¸¸ä½¿ç”¨`splice`
```js
const fruits = ['orange', 'apple', 'lemon', 'banana'];
// remove two items from position 1, and replace it with 'strawberry'
fruits.splice(1, 2, 'strawberry'); // = ['orange', 'strawberry', 'banana']
```
ä¸å¯å˜ ğŸ‘‡ `slice spread`
```js
const fruits = ['orange', 'apple', 'lemon', 'banana'];
const newFruits = [...fruits.slice(0, 1), 'strawberry', ...fruits.slice(3)]; 
// = ['orange', 'strawberry', 'banana']
```

##### æ’åºä¸åè½¬

```js
const fruits = ['orange', 'apple', 'lemon', 'banana'];
fruits.sort(); // = ['apple', 'banana', 'lemon', 'orange'];
fruits.reverse(); // = ['orange', 'lemon', 'banana', 'apple'];
```
ä¸å¯å˜ ğŸ‘‡
```js
const fruits = ['orange', 'apple', 'lemon', 'banana'];
const sorted = [...fruits].sort(); // = ['apple', 'banana', 'lemon', 'orange'];
const inverted = [...fruits].reverse(); // = ['banana', 'lemon', 'apple', 'orange'];
const sortedAndInverted = [...sorted].reverse(); // = ['orange', 'lemon', 'banana', 'apple'];
```

### ä¸å¯å˜å¯¹è±¡æ“ä½œ

#### ä¿®æ”¹å’Œ/æˆ–æ·»åŠ å±æ€§
```js
const state = {
  selected: 'apple',
  quantity: 13,
  fruits: ['orange', 'apple', 'lemon', 'banana']
};
state.selected = 'orange';
state.quantity = 5;
state.origin = 'imported from Spain';
/* 
state = {
  selected: 'orange',
  quantity: 5,
  fruits: ['orange', 'apple', 'lemon', 'banana'],
  origin: 'imported from Spain'
}
*/
```

ä¸å¯å˜ ğŸ‘‡
```js
const state = {
  selected: 'apple',
  quantity: 13,
  fruits: ['orange', 'apple', 'lemon', 'banana']
};
const newState = {
  ...state,
  selected: 'orange',
  quantity: 5,
  origin: 'imported from Spain'
};
/* 
newState = {
  fruits: ['orange', 'apple', 'lemon', 'banana'],
  selected: 'orange',
  quantity: 5,
  origin: 'imported from Spain'
}
*/
```


#### åˆ é™¤å±æ€§
åªéœ€è°ƒç”¨ `delete`

```js
const state = {
  selected: 'apple',
  quantity: 13,
  fruits: ['orange', 'apple', 'lemon', 'banana']
};
delete state.quantity;
/* 
state = {
  selected: 'apple',
  fruits: ['orange', 'apple', 'lemon', 'banana']
} 
*/
```
ä¸å¯å˜ ğŸ‘‡
`rest spread...`
```js
const state = {
  selected: 'apple',
  quantity: 13,
  fruits: ['orange', 'apple', 'lemon', 'banana']
};
const { quantity, ...newState } = state;
/* 
quantity = 13
newState = {
  selected: 'apple',
  fruits: ['orange', 'apple', 'lemon', 'banana']
}
*/
```

#### å¤æ‚ç»“æ„

å½“å…·æœ‰åµŒå¥—æ•°ç»„æˆ–å¯¹è±¡æ—¶.

```js
const state = {
  selected: 4,
  gang: [
    'Mike',
    'Dustin',
    'Lucas',
    'Will',
    'Jane'
  ]
};
const newState = { ...state };
newState.selected = 11;
newState.gang.push('Max');
newState.gang.push('Suzie');
/* 
state = {
  selected: 4,
  gang: [
    'Mike',
    'Dustin',
    'Lucas',
    'Will',
    'Jane'
    'Max',
    'Suzie'
  ]
}
newState = {
  selected: 11,
  gang: [
    'Mike',
    'Dustin',
    'Lucas',
    'Will',
    'Jane'
    'Max',
    'Suzie'
  ]
}
state.gang === newState.gang
*/
```

å¯¹å¤æ‚ç»“æ„æ‰§è¡Œæ“ä½œä¼šä½¿ç»“æ„çš„è¾ƒæµ…ï¼ˆç¬¬ä¸€çº§ï¼‰å¤åˆ¶.  
åœ¨è¿™é‡Œï¼Œå®ƒåªå¤åˆ¶å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å®é™…æ•°ç»„ã€‚
å‘æ•°ç»„`æ·»åŠ `æ–°å…ƒç´ å¯¹ å’Œ `.` éƒ½æœ‰å½±å“ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬åˆ†å¸ƒæ•°ç»„ã€‚

```js
const newState = { 
  ...state, 
  gang: [...state.gang] 
};
```
ğŸ‘‡

```js
const state = {
  selected: 4,
  gang: [
    { id: 1, name: 'Mike' },
    { id: 2, name: 'Dustin' },
    { id: 3, name: 'Lucas' },
    { id: 4, name: 'Will' },
    { id: 11, name: 'Jane' }
  ]
}
const newState = {
  selected: 11,
  gang: [...state.gang]
}
newState.gang[4].name = 'Eleven';
/* 
state = {
  selected: 4,
  gang: [
    { id: 1, name: 'Mike' },
    { id: 2, name: 'Dustin' },
    { id: 3, name: 'Lucas' },
    { id: 4, name: 'Will' },
    { id: 11, name: 'Eleven' }
  ]
}
newState = {
  selected: 11,
  gang: [
    { id: 1, name: 'Mike' },
    { id: 2, name: 'Dustin' },
    { id: 3, name: 'Lucas' },
    { id: 4, name: 'Will' },
    { id: 11, name: 'Eleven' }
  ]
}
*/
```

å…³äºæ€§èƒ½çš„ä¸€å¥è¯
æ€§èƒ½å¦‚ä½•ï¼Œåˆ›å»ºæ–°å¯¹è±¡çš„æ—¶é—´å’Œå†…å­˜ä¸è´¹æ—¶å—ï¼Ÿ  
å—¯ï¼ŒçœŸçš„ï¼Œå®ƒé™„å¸¦å¤šä¸€ç‚¹å¼€é”€ã€‚ä½†ä¸ä¼˜åŠ¿ç›¸æ¯”ï¼Œè¿™ç§åŠ£åŠ¿éå¸¸å°ã€‚

Javascript ä¸­æ›´å¤æ‚çš„æ“ä½œä¹‹ä¸€æ˜¯è·Ÿè¸ªå¯¹è±¡æ˜¯å¦æ›´æ”¹ã€‚  
è¿™æ ·çš„è§£å†³æ–¹æ¡ˆç›¸å½“æ²‰é‡ã€‚
ä½†æ˜¯ï¼Œå¦‚æœä¿æŒçŠ¶æ€ä¸å˜ï¼Œæ‚¨å¯ä»¥åªä¾é æ£€æŸ¥çŠ¶æ€æ˜¯å¦æ›´æ”¹ï¼Œè¿™å°±å°äº†è®¸å¤šCPUè¦æ±‚  
ç¬¬äºŒå¤§ä¼˜åŠ¿æ˜¯ä»£ç è´¨é‡ã€‚  
ç¡®ä¿çŠ¶æ€ä¸å˜ä¼šè¿«ä½¿æ‚¨æ›´å¥½åœ°è€ƒè™‘åº”ç”¨ç¨‹åºç»“æ„ã€‚å®ƒé¼“åŠ±ä»¥æ›´å®ç”¨çš„æ–¹å¼ç¼–ç¨‹ï¼Œä½¿ä»£ç æ˜“äºéµå¾ªï¼Œå¹¶å‡å°‘äº†è®¨åŒé”™è¯¯çš„å¯èƒ½æ€§ã€‚

å…¶ä»–é˜…è¯»:
https://dev.to/glebec/four-ways-to-immutability-in-javascript-3b3l
